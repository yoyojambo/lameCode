<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>LameCode - {{ .Problem.Title }}</title>
  <!-- Minimal CSS (Skeleton) -->
  <link rel="stylesheet" href="/assets/custom.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/skeleton/2.0.4/skeleton.min.css">
  <script src="https://cdn.jsdelivr.net/npm/htmx.org@1.9.2"></script>
  <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.47.0/min/vs/loader.js"></script>

  <style>
    /* Container override for a bit more width */
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 1rem;
    }
    /* Avatar */
    .avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      vertical-align: middle;
      margin-right: 0.5rem;
    }

    /* Boxes for the left (problem) and right (editor) columns */
    

    /* Difficulty label styling */
    .difficulty {
      display: inline-block;
      padding: 0.2rem 0.6rem;
      border-radius: 4px;
      color: #fff;
      margin-bottom: 1rem;
      background-color: #636363;
    }
    .easy {
      background-color: #28a745; /* green */
    }
    .medium {
      background-color: #ffc107; /* yellow/orange */
      color: #000;
    }
    .hard {
      background-color: #dc3545; /* red */
    }

    /* Code editor container */
    body.htmx-request .spinner { display: inline-block; }
    .spinner { display: none; }
    .editor-container { display: flex; flex-direction: column; height: 100%; }
    #code-editor { flex: 1; border: 1px solid #ccc; }
    .results { height: 200px; border: 1px solid #ccc; overflow: auto; }
    .editor-top-bar, .editor-bottom-bar { padding: 8px; background: #f0f0f0; }

    #code-editor {
	width: 100%;
	height: 400px;       /* or whatever fits your layout */
	min-height: 300px;   /* ensures it never collapses above this */
    }

    /* —or— use flex on the container so the editor stretches: */
    .editor-container {
	display: flex;
	flex-direction: column;
	position: relative;
	height: 100%;       /* make sure parent has a height too */
    }
    #code-editor {
	flex: 1 1 auto;
	min-height: 300px;
    }

    /* /\* Editor top bar: language dropdown, reset, gear *\/ */
    /* .editor-top-bar { */
    /*   display: flex; */
    /*   align-items: center; */
    /*   margin-bottom: 0.5rem; */
    /* } */
    /* .editor-top-bar select { */
    /*   margin-right: 1rem; */
    /* } */
    /* .editor-top-bar button { */
    /*   margin-right: 0.5rem; */
    /* } */

    /* Tab buttons (Editor, Results) */
    .editor-tabs {
      margin-bottom: 0.5rem;
    }
    .tab-button {
      background: #e9ecef;
      border: 1px solid #ccc;
      border-radius: 4px;
      padding: 0.5rem 1rem;
      cursor: pointer;
      margin-right: 0.5rem;
      outline: none;
    }
    .tab-button.active {
      background-color: #d1d3d4;
      border-bottom: 2px solid #000;
    }

    /* Tab content areas */
    .tab-content {
      background-color: #f8f8f8;
      border: 1px solid #ccc;
      border-radius: 4px;
      padding: 0.5rem;
      min-height: 300px;
    }

    /* Code text area to look seamless */
    .code-textarea {
      width: 100%;
      border: none;
      background-color: transparent;
      resize: none;
      font-family: "Courier New", Courier, monospace;
      font-size: 0.9rem;
      outline: none;
      height: 300px; /* or adjust as needed */
    }

    /* Bottom bar with Test/Submit dropdown */
    .editor-bottom-bar {
      margin-top: 1rem;
      text-align: right;
    }
    .dropdown {
      display: inline-block;
      position: relative;
    }
    .dropdown-content {
      display: none;
      position: absolute;
      right: 0;
      background-color: #fff;
      border: 1px solid #ccc;
      min-width: 100px;
      z-index: 999;
    }
	
    .dropdown-content a {
      display: block;
      padding: 0.5rem;
      text-decoration: none;
      color: #333;
    }
    .dropdown-content a:hover {
      background-color: #f2f2f2;
    }
    .dropdown:hover .dropdown-content {
      display: block;
    }

    /* Modal styling (simple example) */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.5);
    }
    .modal-content {
      background-color: #fff;
      margin: 10% auto;
      padding: 1rem;
      width: 400px;
      border-radius: 4px;
    }
    .modal-header {
      font-weight: bold;
      margin-bottom: 1rem;
    }
    .close {
      float: right;
      cursor: pointer;
      font-weight: bold;
    }
  </style>
</head>
<body>
  {{template "navbar"}}

  <!-- Main Content -->
  <div id="main" class="container">
	{{block "problem" .}}
    <div class="row">
      <!-- Left Column: Problem Details -->
      <div class="six columns box">
        <h3>{{ .Problem.Title }}</h3>
        {{/* Difficulty label logic */}}
        {{ if eq .Problem.Difficulty 1 }}
        <span class="difficulty easy">Easy</span>
        {{ else if eq .Problem.Difficulty 2 }}
        <span class="difficulty medium">Medium</span>
        {{ else if eq .Problem.Difficulty 3 }}
        <span class="difficulty hard">Hard</span>
        {{ else }}
        <span class="difficulty">Not tagged</span>
        {{ end }}

        <!-- Problem description is rendered as HTML -->
        <div id="problem-description">
          {{ .Problem.Description }}
        </div>
      </div>

      <!-- Right Column: Code Editor and Results -->

      <div class="six columns box" style="margin-left: 1%">
		<div class="editor-container">
		  <div class="editor-top-bar">
			<select id="language-select" name="language">
			  <option value="go">Go</option>
			  <option value="python">Python</option>
			  <option value="javascript">JavaScript</option>
			</select>
			<button id="reset-button" type="button">Reset</button>
		  </div>

		  <div id="code-editor"></div>
		  <textarea id="code-input" name="code" hidden></textarea>

		  <div class="editor-bottom-bar">
			<button id="test-button"
					hx-post="/judge/test"
					hx-include="#code-input,#language-select"
					hx-target="#results"
					hx-swap="innerHTML"
					hx-indicator=".spinner"
					type="button"
					onclick="document.getElementById('code-input').value = window.editor.getValue()"
					>Test</button>

			<button id="submit-button"
					hx-post="/judge/submit"
					hx-include="#code-input,#language-select"
					hx-target="#submission-modal .modal-content p"
					hx-swap="innerHTML"
					hx-indicator=".spinner"
					type="button"
					onclick="document.getElementById('code-input').value = window.editor.getValue()"
					>Submit</button>

			<div class="spinner">⏳</div>
		  </div>

		  <div id="results" class="results">No results yet.</div>
		</div>
	  </div>

      <div id="submission-modal" class="modal" style="display:none">
		<div class="modal-content">
		  <span class="close" onclick="document.getElementById('submission-modal').style.display='none'">&times;</span>
		  <p>Your code has been submitted. We’ll let you know the results soon!</p>
		</div>
      </div>

    </div>
      {{end}}
  </div>

  <script>
    require.config({ paths: { vs: 'https://cdn.jsdelivr.net/npm/monaco-editor@0.47.0/min/vs' } });
    require(['vs/editor/editor.main'], function() {
	window.editor = monaco.editor.create(
	    document.getElementById('code-editor'), {
		value: "// Your code here",
		language: 'go',
		automaticLayout: true
	    }
	);

	// Later there could be better initial code given, that parses input for instance.
	{{if .InitialCode}}
	{{else}}
	resetLanguage()
	{{end}}
    });

    
    const defaultSnippets = {
	go: `package main

func main() {
    // your Go solution here
}
`,
	python: `def main():
    # your Python solution here

if __name__ == "__main__":
    main()
`,
	javascript: `function main() {
    // your JS solution here
}

main();
`
    };

    const resetLanguage = () => {
	const lang = languageSelect.value;
	monaco.editor.setModelLanguage(editor.getModel(), lang);
	editor.setValue(defaultSnippets[lang] || '');
    }

    const languageSelect = document.getElementById('language-select');
    languageSelect.addEventListener('change', resetLanguage);

    // also update your Reset button to use the map:
    document.getElementById('reset-button').addEventListener('click', () => {
	const lang = languageSelect.value;
	editor.setValue(defaultSnippets[lang] || '');
    });

    document.getElementById('reset-button').addEventListener('click', resetLanguage);

    document.body.addEventListener('htmx:afterSwap', function(evt) {
	if (evt.detail.target.id === 'results') {
	    evt.detail.target.scrollTop = 0;
	}
    });
  </script>
</body>
</html>
